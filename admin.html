<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CGC Admin Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 25px; }
        h2, h3 { color: var(--primary); margin-top: 0; }
        
        /* Grid for the Input Form */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .form-group label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #64748b; }
        input, select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box; }
        
        /* Table Styling */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { text-align: left; padding: 14px; border-bottom: 1px solid #e2e8f0; }
        th { background: #f1f5f9; font-weight: 600; font-size: 13px; text-transform: uppercase; }
        
        /* Buttons */
        .btn { padding: 10px 20px; border-radius: 6px; cursor: pointer; border: none; font-weight: 600; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-danger { background: #ef4444; color: white; font-size: 12px; }
        
        /* Sections Visibility */
        #auth-section, #admin-section { display: none; }
        
        /* Login Specific */
        .login-card { max-width: 400px; margin: 100px auto; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div id="auth-section" class="card login-card">
        <h2>CGC Admin Login</h2>
        <p>Please sign in to manage the consultant database.</p>
        <input type="email" id="email" placeholder="Admin Email" style="margin-bottom: 10px;">
        <input type="password" id="password" placeholder="Password" style="margin-bottom: 20px;">
        <button class="btn btn-primary" onclick="handleLogin()">Sign In</button>
    </div>

    <div id="admin-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2>CGC Internal Management</h2>
            <button class="btn" style="background: #64748b; color: white;" onclick="handleLogout()">Logout</button>
        </div>

        <div class="card">
            <h3>Add New Consultant</h3>
            <div class="form-grid">
                <div class="form-group"><label>Full Name</label><input type="text" id="newName"></div>
                <div class="form-group"><label>Age</label><input type="number" id="newAge"></div>
                <div class="form-group"><label>Experience</label><input type="text" id="newExp" placeholder="e.g. 15 years"></div>
                <div class="form-group"><label>Specialization</label><input type="text" id="newSpec"></div>
                <div class="form-group"><label>Geography</label><input type="text" id="newGeo"></div>
                <div class="form-group"><label>Availability</label><input type="text" id="newAvail" placeholder="e.g. Available"></div>
                <div class="form-group"><label>Contact</label><input type="email" id="newContact"></div>
                <div class="form-group"><label>Partnership</label><input type="text" id="newPartner"></div>
                <div class="form-group" style="grid-column: span 2;">
                    <label>Skills (comma separated)</label>
                    <input type="text" id="newSkills" placeholder="Strategy, SAP, Logistics">
                </div>
            </div>
            <button class="btn btn-primary" onclick="addConsultant()">Save to Database</button>
        </div>

        <div class="card">
            <h3>Consultant Registry</h3>
            <div class="table-container">
                <table id="consultantTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Specialization</th>
                            <th>Geography</th>
                            <th>Skills</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // --- CONFIGURATION ---
    const SUPABASE_URL = "https://wiuglzsjyzogfpqjlhvp.supabase.co"; 
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndpdWdsenNqeXpvZ2ZwcWpsaHZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2MzY3MjAsImV4cCI6MjA4MzIxMjcyMH0.P45KBpD1fbLu3tCu5Cbt31m0vhcTQfFc_tWCyX5FAeM";

    // Initialize client with a unique name to avoid syntax errors
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // 1. Check Session on Load
    window.onload = async () => {
        const { data: { session } } = await _supabase.auth.getSession();
        if (session) { showAdmin(); } else { showLogin(); }
    };

    // 2. Authentication Functions
    async function handleLogin() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const { error } = await _supabase.auth.signInWithPassword({ email, password });
        if (error) {
            alert("Login Error: " + error.message);
        } else {
            showAdmin();
        }
    }

    async function handleLogout() {
        await _supabase.auth.signOut();
        location.reload();
    }

    function showLogin() { document.getElementById('auth-section').style.display = 'block'; }
    
    async function showAdmin() {
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('admin-section').style.display = 'block';
        loadConsultants();
    }

    // 3. Database Functions
    async function loadConsultants() {
        const { data, error } = await _supabase.from('consultants').select('*');
        if (error) return console.error("Load Error:", error);
        
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = data.map(c => `
            <tr>
                <td><strong>${c.name}</strong></td>
                <td>${c.specialization}</td>
                <td>${c.geography}</td>
                <td>${Array.isArray(c.skills) ? c.skills.join(', ') : c.skills}</td>
                <td>
                    <button class="btn btn-danger" onclick="deleteConsultant('${c.name}')">Delete</button>
                </td>
            </tr>
        `).join('');
    }

    async function addConsultant() {
        // Convert comma string to Array for the database
        const skillsArray = document.getElementById('newSkills').value.split(',').map(s => s.trim());
        
        const newEntry = {
            name: document.getElementById('newName').value,
            age: parseInt(document.getElementById('newAge').value),
            experience: document.getElementById('newExp').value,
            skills: skillsArray,
            specialization: document.getElementById('newSpec').value,
            geography: document.getElementById('newGeo').value,
            availability: document.getElementById('newAvail').value,
            contact: document.getElementById('newContact').value,
            partnership: document.getElementById('newPartner').value
        };

        const { error } = await _supabase.from('consultants').insert([newEntry]);
        if (error) {
            alert("Save Error: " + error.message);
        } else {
            alert("Consultant added successfully!");
            loadConsultants();
            // Clear inputs
            document.querySelectorAll('.form-grid input').forEach(i => i.value = '');
        }
    }

    async function deleteConsultant(name) {
        if (confirm(`Permanent Delete: ${name}?`)) {
            const { error } = await _supabase.from('consultants').delete().eq('name', name);
            if (error) alert(error.message); else loadConsultants();
        }
    }
</script>
</body>
</html>
